<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>배드민턴 코트 배정 시스템 (v2)</title>
    <style>
        /* --- 기본 스타일 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1200px; /* 너비 확장 */
            margin: 0 auto;
        }

        /* --- [신규] 글로벌 컨트롤 --- */
        .global-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .global-controls button {
            padding: 10px 15px;
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
        }

        .global-controls .time-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .global-controls label {
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .global-controls input[type="time"] {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 8px;
        }

        .global-controls #clearMasterTime {
            background-color: #eee;
            color: #555;
            padding: 5px 8px;
            font-size: 0.8rem;
        }

        /* --- 코트 레이아웃 --- */
        .courts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* 최소 너비 조정 */
            gap: 20px;
            margin-bottom: 30px;
        }

        .court {
            position: relative; /* [수정] 번호 배치를 위해 relative 추가 */
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 5px; /* '십자' 모양 */
            background-color: #333; /* 십자선 색상 */
            border: 12px solid #e0e0e0;
            border-radius: 5px;
            padding: 5px;
        }

        /* --- [신규] 코트 번호 스타일 --- */
        .court-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: #333; /* 십자선과 동일한 색상 */
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 10;
            pointer-events: none; /* [중요] 번호가 슬롯 클릭을 방해하지 않도록 함 */
        }

        .player-slot {
            background-color: #f0f0f0;
            color: #aaa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none;
            z-index: 1; /* 번호보다 뒤에 있지만, 상호작용은 가능 */
        }

        .player-slot.filled {
            background-color: #fbc2c2;
            color: #c93a3a;
            font-weight: bold;
        }

        /* --- 대기 명단 --- */
        .waitlist-section {
            background-color: #f2e8e8;
            padding: 20px;
            border-radius: 10px;
        }

        .waitlist-section h3 {
            text-align: left;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: #333;
        }
        
        .add-player-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .add-player-form input[type="text"] {
            flex-grow: 1; /* [수정] 대표 시간 입력은 폼에 없으므로 다시 1로 */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .add-player-form button {
            padding: 10px 20px;
            background-color: #5a8d5a;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .waiting-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* 반응형 3열 */
            gap: 10px;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .wait-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fdf6f6;
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #e0c8c8;
        }

        .wait-item .player-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
        }
        
        .wait-item .wait-time {
            background: #eee;
            padding: 5px 8px;
            border-radius: 3px;
            font-size: 0.9rem;
            font-weight: bold;
            color: #555;
            min-width: 60px;
            text-align: right;
        }
        
        .wait-item .assign-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
            background-color: #4a76c2;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 5px;
        }

    </style>
</head>
<body>

    <div class="container">
        
        <div class="global-controls">
            <button id="addCourtButton">➕ 코트 추가</button>
            <div class="time-control">
                <label for="masterStartTime">대표 시작 시간:</label>
                <input type="time" id="masterStartTime">
                <button id="clearMasterTime" title="대표 시작 시간 지우기">❌</button>
            </div>
        </div>

        <div class="courts-container" id="courtsContainer">
            <div class="court" id="court-1">
                <span class="court-number">1</span>
                <div class="player-slot" data-court="1" data-slot="1">플레이어 1</div>
                <div class="player-slot" data-court="1" data-slot="2">플레이어 2</div>
                <div class="player-slot" data-court="1" data-slot="3">플레이어 3</div>
                <div class="player-slot" data-court="1" data-slot="4">플레이어 4</div>
            </div>
            <div class="court" id="court-2">
                <span class="court-number">2</span>
                <div class="player-slot" data-court="2" data-slot="1">플레이어 1</div>
                <div class="player-slot" data-court="2" data-slot="2">플레이어 2</div>
                <div class="player-slot" data-court="2" data-slot="3">플레이어 3</div>
                <div class="player-slot" data-court="2" data-slot="4">플레이어 4</div>
            </div>
            <div class="court" id="court-3">
                <span class="court-number">3</span>
                <div class="player-slot" data-court="3" data-slot="1">플레이어 1</div>
                <div class="player-slot" data-court="3" data-slot="2">플레이어 2</div>
                <div class="player-slot" data-court="3" data-slot="3">플레이어 3</div>
                <div class="player-slot" data-court="3" data-slot="4">플레이어 4</div>
            </div>
            <div class="court" id="court-4">
                <span class="court-number">4</span>
                <div class="player-slot" data-court="4" data-slot="1">플레이어 1</div>
                <div class="player-slot" data-court="4" data-slot="2">플레이어 2</div>
                <div class="player-slot" data-court="4" data-slot="3">플레이어 3</div>
                <div class="player-slot" data-court="4" data-slot="4">플레이어 4</div>
            </div>
        </div>
        
        <div class="waitlist-section">
            <h3>대기 명단 & 대기 시간 표시</h3>
            
            <div class="add-player-form">
                <input type="text" id="playerNameInput" placeholder="대기자 이름 입력...">
                <button id="addPlayerButton">대기열 추가</button>
            </div>
            
            <ul class="waiting-list" id="waitingList">
                </ul>
        </div>

    </div>

    <script>
        // --- JavaScript (애플리케이션 동작 로직) ---

        // 1. 필요한 HTML 요소들을 가져옵니다.
        const playerNameInput = document.getElementById('playerNameInput');
        const addPlayerButton = document.getElementById('addPlayerButton');
        const waitingListElement = document.getElementById('waitingList');
        const courtsContainer = document.getElementById('courtsContainer'); // [수정] 코트 컨테이너
        
        // [신규] 컨트롤 요소
        const addCourtButton = document.getElementById('addCourtButton');
        const masterStartTimeInput = document.getElementById('masterStartTime');
        const clearMasterTimeButton = document.getElementById('clearMasterTime');

        // 2. 데이터 변수
        let waitingQueue = [];
        let nextId = 0;
        let courtCount = 4; // [신규] 현재 코트 수 추적

        // 3. (함수) 대기열 목록을 화면에 렌더링 (업데이트)
        function renderWaitingList() {
            waitingListElement.innerHTML = '';
            const now = Date.now();

            waitingQueue.forEach(player => {
                const elapsedSeconds = Math.floor((now - player.startTime) / 1000);
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;
                
                const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}초`;

                const li = document.createElement('li');
                li.className = 'wait-item';
                li.innerHTML = `
                    <span class="player-name">${player.name}</span>
                    <span class="wait-time">${formattedTime}</span>
                    <button class="assign-btn" data-player-id="${player.id}">배정</button>
                `;
                waitingListElement.appendChild(li);
            });
        }

        // 4. (함수) 대기열에 새 플레이어 추가 - [수정됨]
        function addPlayerToQueue() {
            const name = playerNameInput.value.trim();
            if (name === "") {
                alert("플레이어 이름을 입력하세요!");
                return;
            }

            // --- [신규 로직] 대표 시작 시간 확인 ---
            let startTime = Date.now(); // 기본값: 현재 시간
            const masterTimeValue = masterStartTimeInput.value;

            if (masterTimeValue) {
                const [hours, minutes] = masterTimeValue.split(':').map(Number);
                const manualStartTime = new Date();
                manualStartTime.setHours(hours, minutes, 0, 0); // 오늘 날짜의 해당 시간으로 설정

                const now = new Date();
                if (manualStartTime.getTime() > now.getTime()) {
                    alert("대표 시작 시간은 현재 시간보다 미래일 수 없습니다.");
                    return;
                }
                startTime = manualStartTime.getTime(); // 수동 설정된 시간 사용
            }
            // --- [신규 로직 끝] ---

            const newPlayer = {
                id: nextId++,
                name: name,
                startTime: startTime // 동적으로 설정된 시간
            };
            
            waitingQueue.push(newPlayer);
            playerNameInput.value = ''; // 이름 입력창만 비움
            renderWaitingList();
        }
        
        // 5. (함수) 플레이어를 빈 코트 슬롯에 배정 - [수정됨]
        function assignPlayer(playerId) {
            // [수정] 함수가 호출될 때마다 최신 슬롯 목록을 가져옴
            const playerSlots = document.querySelectorAll('.player-slot');
            
            let emptySlot = null;
            for (const slot of playerSlots) {
                if (!slot.classList.contains('filled')) {
                    emptySlot = slot;
                    break;
                }
            }
            
            if (!emptySlot) {
                alert("모든 코트가 꽉 찼습니다!");
                return;
            }

            const playerIndex = waitingQueue.findIndex(p => p.id == playerId);
            if (playerIndex === -1) return;

            const player = waitingQueue[playerIndex];
            
            emptySlot.classList.add('filled');
            emptySlot.textContent = player.name;
            emptySlot.dataset.playerName = player.name; 

            waitingQueue.splice(playerIndex, 1);
            renderWaitingList();
        }
        
        // 6. (함수) 코트 슬롯 비우기 (클릭 시)
        function clearSlot(event) {
            // [수정] 이벤트 위임을 사용하므로 event.target이 slot이 됨
            const slot = event.target; 
            
            if (slot.classList.contains('filled')) {
                const playerName = slot.dataset.playerName;
                
                if (confirm(`'${playerName}'님의 배정을 취소하고 대기열로 돌려보내시겠습니까?`)) {
                    
                    const reQueuedPlayer = {
                        id: nextId++,
                        name: playerName,
                        startTime: Date.now()
                    };
                    waitingQueue.push(reQueuedPlayer);

                    slot.classList.remove('filled');
                    slot.textContent = `플레이어 ${slot.dataset.slot}`;
                    delete slot.dataset.playerName;
                    
                    renderWaitingList(); 
                }
            }
        }

        // 7. [신규] (함수) 새 코트 추가
        function addCourt() {
            courtCount++; // 코트 번호 증가
            
            const newCourt = document.createElement('div');
            newCourt.className = 'court';
            newCourt.id = `court-${courtCount}`;
            
            // 새 코트의 내부 HTML 생성
            newCourt.innerHTML = `
                <span class="court-number">${courtCount}</span>
                <div class="player-slot" data-court="${courtCount}" data-slot="1">플레이어 1</div>
                <div class="player-slot" data-court="${courtCount}" data-slot="2">플레이어 2</div>
                <div class="player-slot" data-court="${courtCount}" data-slot="3">플레이어 3</div>
                <div class="player-slot" data-court="${courtCount}" data-slot="4">플레이어 4</div>
            `;
            
            // 컨테이너에 새 코트 추가
            courtsContainer.appendChild(newCourt);
            
            // [참고] 슬롯 클릭 이벤트는 '이벤트 위임'으로 처리되므로
            // 새 슬롯에 일일이 이벤트를 추가할 필요가 없습니다.
        }

        // --- 이벤트 리스너 연결 ---

        // '대기열 추가' 버튼
        addPlayerButton.addEventListener('click', addPlayerToQueue);
        playerNameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addPlayerToQueue();
        });

        // [신규] '코트 추가' 버튼
        addCourtButton.addEventListener('click', addCourt);
        
        // [신규] '대표 시간 지우기' 버튼
        clearMasterTimeButton.addEventListener('click', () => {
            masterStartTimeInput.value = '';
        });

        // '배정' 버튼 (이벤트 위임)
        waitingListElement.addEventListener('click', function(e) {
            if (e.target.classList.contains('assign-btn')) {
                const playerId = e.target.dataset.playerId;
                assignPlayer(playerId);
            }
        });
        
        // [수정] 코트 슬롯 클릭 (이벤트 위임)
        // 개별 슬롯이 아닌, 부모인 'courtsContainer'에 리스너를 한 번만 등록
        courtsContainer.addEventListener('click', function(e) {
            // 클릭된 요소가 'player-slot' 클래스를 가졌는지 확인
            if (e.target.classList.contains('player-slot')) {
                clearSlot(e); // 이벤트 객체를 그대로 넘김
            }
        });

        // 1초마다 타이머 갱신
        setInterval(renderWaitingList, 1000);

        // (초기 로드) 예시 데이터
        waitingQueue = [
            { id: nextId++, name: '박성준', startTime: Date.now() - 10000 },
            { id: nextId++, name: '강준시', startTime: Date.now() - 20000 },
            { id: nextId++, name: '고도한', startTime: Date.now() - 30000 },
        ];
        renderWaitingList();

    </script>
</body>
</html>
